---
layout: default
title: Handling alert for AccessGroup Discrepancies Report
type: Operations
runbook-name: "compliance_AccessGroups_Discrepancies_Report"
description: "This runbook describes how to handle errors in AccessGroups Discrepancies Report"
service: Conductors
link: ./compliance-AccessGroups-Discrepancies-Report.html
parent: Armada Runbooks

---

Ops
{: .label .label-green}

## Overview

The Jenkins Job [AccessGroups Discrepancies Report](https://alchemy-conductors-jenkins.swg-devops.com/job/Conductors/job/Security-Compliance/job/compliance-argonauts-access-AccessGroups-Discrepancies-Report/) generates a report of discrepancies between the state of Access Groups in `argonauts-access` repos `role-config` and `access-group-config` against the actual state in the managed IKS cloud accounts. This document provides guidance on how to handle the PD alerts produced by when running the job.

## Detailed Information

Two types of alerts can be generated by the Jenkins job which are:

1. `Discrepancy Reported for AccessGroups in IAM` alert  
_See [Discrepancy report](#discrepancy-reported) section below_
1. `AccessGroups Discrepancy Reporting job failed` alert  
_See [System failures/Job failure](#system-failuresjob-failure) section below_

## Detailed Procedure

## Discrepancy reported

**Sample alert:** [https://ibm.pagerduty.com/incidents/Q3NRBW3N8Q62JH](https://ibm.pagerduty.com/incidents/Q3NRBW3N8Q62JH)

The alert will be generated when any discrepancies between the expected (in config files) and actual (in cloud accounts) state of access groups is discoverted.

The cases that can lead to this error (thought only one is live currently):

### Case1: Discrepancy between role-config and IKS Cloud account

If there is a discrepancy between role-config JSON config files and IKS cloud account then the report will include:

```
## Comparing role-config json files vs cloud...
    - Access Groups in cloud 48
     - Intersection for 'role_iks_sre-au'[8] is 8
     - Intersection for 'role_iks_sre-in'[8] is 8
     - Intersection for 'role_iks_sre-ie'[9] is 8

   - ERROR: In role-config 9 and not in cloud: 1
          : Orphaned role_config access groups: {'Farhan_test_AG'}

     - Intersection for 'role_iks_sre-gb'[8] is 8
     - Intersection for 'role_iks_sre-us'[8] is 8
     - Intersection for 'role_iks_sre-bnpp'[9] is 9
     - Intersection for 'role_iks_automation-non-production'[8] is 8
     - Intersection for 'role_iks_sre-netint'[7] is 7
     - Intersection for 'role_iks_developer'[8] is 8

     --> Errors encountered with json files for 'argonauts-dev'
```

In this example, the Access group `Farhan_test_AG` is unexpected. The status of this access group needs to be confirmed account owner/access group owner.
- If it is needed, then a corresponding access groups needs to be created in the IBM cloud account using the [terraform-access-group-config](https://github.ibm.com/argonauts-access/access-group-config) repo.
- In the case where the access group is not needed, then it should be removed from the [role-config](https://github.ibm.com/argonauts-access/role-config) repo JSON file.

### Case2: Discrepancy between access-group-config and IKS Cloud account  
#### _NB. Currently these are only **warning** messages, no PD is raised - but may be in future_

#### Example1:
If there is a discrepancy between `access-group-config` (Terraform `tf` files) and IKS cloud account then the report will include:

```
# Account: 'dev-containers'
    - acquiring details from cloud account [cloud.ibm.com] dev-containers...
    - acquiring details from tf source files 'tf/com_ibm_cloud/dev-containers'...

 ## Comparing access-group-config tf files vs cloud...
    - IDs intersection: 113
      - In cloud 116 and not in tf: 3
      - In tf 113 and not in cloud: 0

      - Non-terraform managed resources 3:

- Access Group: GhoST Tagging
AccessGroupId-18da4cf6-3e6f-4fce-af76-2bc358d8ba86
AccessGroupId-18da4cf6-3e6f-4fce-af76-2bc358d8ba86/2048afc1-dfeb-4849-93aa-d6c982329e28
AccessGroupId-18da4cf6-3e6f-4fce-af76-2bc358d8ba86/9e04bcb8-cff5-4492-9139-57d16172c43c

 --> WARNING: issues to address with tf files for 'dev-containers'
```

In this example, the Access Group `GhoST Tagging` with its policies is not present in tf files, but is present in the Cloud account.

The access group and the policies need to be confirmed by account owner/access groups owner if they are correct or not.

- If these are not needed then, they can be deleted from IBM Cloud UI.
- In the case they are needed then they can be specified in the tf files for the account - in [terraform-access-group-config](https://github.ibm.com/argonauts-access/access-group-config) repo - so that they become managed.

#### Example2:
The report for account could also include like:

```
# Account: 'registry-dev'
    - acquiring details from cloud account [cloud.ibm.com] registry-dev...
    - acquiring details from tf source files 'tf/com_ibm_cloud/registry-dev'...

 ## Comparing access-group-config tf files vs cloud...
    - IDs intersection: 84
      - In cloud 88 and not in tf: 4
      - In tf 84 and not in cloud: 0

      - Non-terraform managed resources 4:

- Policies for Access Group: SQUAD_FCTID (ie. Access Group itself isn't unknown, just the listed policies)
AccessGroupId-19b15fd6-eea4-4fbe-a12f-4d6ce27830f2/6cc2b150-484c-4d7b-9ab5-3daf222a3bed
AccessGroupId-19b15fd6-eea4-4fbe-a12f-4d6ce27830f2/736530f6-2449-4a63-9ded-7e9d68f440c9
AccessGroupId-19b15fd6-eea4-4fbe-a12f-4d6ce27830f2/a61ef313-36fc-46a9-b360-ba2dab1052db
AccessGroupId-19b15fd6-eea4-4fbe-a12f-4d6ce27830f2/ac4f938f-fe13-4f2b-bec8-ebb3c462a022

 --> WARNING: issues to address with tf files for 'registry-dev'
```

In above example the Access Group `SQUAD_FCTID` is correct and expected but it has 4 extra policies that are not present in the tf files.

These policies need to be confirmed by account owner/access groups owner if they are correct or not.
- If these are not needed then, they can be deleted from IBM Cloud UI.
- In the case they are needed then they can be specified in the tf files for the account in [terraform-access-group-config](https://github.ibm.com/argonauts-access/access-group-config) repo so that they become managed.

## System failures/Job failure

**Sample alert:** [https://ibm.pagerduty.com/incidents/Q0UAPOTEZFFQTF](https://ibm.pagerduty.com/incidents/Q0UAPOTEZFFQTF)

If due to unexpected errors, the jenkins job fails then an error alert will be generated.

The job is critical for reporting as there should be no discrepancy between the Access Group config and the actual state of environment.

Please investigate the reason why the job is failing and try to fix it as soon as possible - reach out in [#sre-accesshub-team](https://ibm-argonauts.slack.com/archives/G01LJ0V9FBK) channel in case of help/questions.

## Escalation Policy

Reach out to the IKS SRE in [#sre-accesshub-team](https://ibm-argonauts.slack.com/archives/G01LJ0V9FBK) or [#conductors](https://ibm-argonauts.slack.com/archives/C54H08JSK) if you have any issues.
