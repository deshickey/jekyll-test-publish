---
layout: default
title: Handling alert for Yubikey Validation
type: Operations
runbook-name: "compliance_yubikey_validation"
description: "This runbook describes how to handle alerts in Yubikey Validation"
service: Conductors
link: /compliance_yubikey_validation.html
parent: Armada Runbooks

---

Ops
{: .label .label-green}

## Overview

This Jenkins Job [Yubikey Validation](https://alchemy-conductors-jenkins.swg-devops.com/view/Conductors/job/Conductors/job/Security-Compliance/job/yubikey-validation/) generates and uploads a daily report of compliant yubikey users. This document provides guidance on how to handle the PD alerts produced by when running the job.

This job runs daily at 14:30 UTC

## Detailed information

Two types of alerts can be generated by the Jenkins job which are:

1. `A non compliant user has been found in <Account Num>` alert  
_See [Non Compliant User](#non-compliant-user) section below_
1. `Yubikey validation job failed` alert  
_See [Validation Job Failed](#validation-job-failed) section below_

## Useful links

https://github.ibm.com/alchemy-conductors/yubikey-validation#reference-links

## Detailed Procedure

## Non Compliant User

In order to be compliant, a user must have their yubikey enabled and have a valid record in SL active directory (IMS).

If a non-compliant user is found, the jenkins job will create an issue in [alchemy-containers-armada](https://github.ibm.com/alchemy-containers/armada/issues/) labelled `yubikey-compliance`. The GHE URL is in the `ghe_issue_url` section of the alert.  
[Example Yubikey Issue](https://github.ibm.com/alchemy-containers/armada/issues/2215)

1. When a PD alert is raised, post the following to the #conductors channel along with the GHE URL to the github issue.  
"`@<NON_COMPLIANT_USER>` the mfa validator has flagged your userid as having an expired IMS/SL account or missing yubikey."  
 The reported non-compliant user will need to investigate and fix their yubikey status. Recommended starting point is #sl-helpdesk.

2. Post to the `#iks-sre-compliance` channel -> "Yubikey compliance alert received" & the pagerduty alert URL. Then resolve the alert.

## Validation Job Failed

If due to unexpected errors, the jenkins job fails then an error alert will be generated.

The jenkins jobs calls a 3rd party script provided the CISO team. This script calls multiple backend api's. If the script fails to connect to an API either by timeout, 504 etc.. Rebuild the job manually.

If it is still failing go to the Escalation Policy below.

### Known failures

- Upstream w3/bluepages api issues
```
Problems getting Bluepages Extractor query task results Error: read ECONNRESET
OR
Problems checking Bluepages Extractor query task status TypeError: Cannot read property
```
- Github issues
User not in github 
OR 
User cannot be assigned to an issue. To fix this, the user needs write access to at least one github team.
```
github.GithubException.GithubException: 422 {"message": "Validation Failed", "errors": [{"value": "<USER>", "resource": "Issue", "field": "assignees", "code": "invalid"}], "documentation_url": 
```


Sample Successful CISO script output
```
========= Running MFA Validator Script ==========
+ ./mfavalidator -s containers-kubernetes -i e223e119c9be31669e5688bb376411f7 -k **** -g **** --upload true
Reading from yubikey20220115.csv that is yesterday's file
>> Getting managers in containers-kubernetes
 >> Submit request ...
 >> Waiting 2 secs ...
 >> Getting request results ...
>> Getting functional ids in containers-kubernetes
 >> Submit request ...
 >> Waiting 2 secs ...
 >> Getting request results ...
File containers-kubernetes/yubikey-containers-kubernetes-20220115.csv successfully updated
Finished: SUCCESS
```


## Escalation Policy

For assistance reach out in the `#iks-sre-compliance` channel - tag @pkelly & @colin