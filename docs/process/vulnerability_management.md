---
layout: default
title: Vulnerability Management for the Armada Control Plane
type: Process
parent: Policies & Processess
---

Process
{: .label .label-green}

## **Vulnerability Management**

### Purpose

Remediation of vulnerabilities in the machines on the Armada control plane that are detected by automated scans or manual testing.

### Security scans and reviews

Application scanning and penetration tests are required regularly. The various scans, tests, and reviews involved are outlined in this section.

#### Nessus

Nessus scans will be performed no less than weekly against all machines in the production IBM Cloud Kubernetes Service and IBM Cloud Container Registry control plane to detect security vulnerabilities. This corresponds to all live production machines in the SOS Inventory for the ALC client code (plus the subset of the ARMADA client code used by ICCR for its Kubernetes workers).

Vulnerabilities discovered from Nessus scans will be raised as GHE issues.  See [Remediation of vulnerabilities](#remediation-of-vulnerabilities) for timelines that apply to remediation.

The GitHub issues will be created automatically in the [alcatraz](https://github.ibm.com/alchemy-conductors/alcatraz/issues?q=is%3Aopen+is%3Aissue+label%3Asos.nessus) GHE repository. Jason Geer and Michael Christensen are the contacts for the tool that creates the GHE issues.

#### PCI-DSS ASV Scans

For PCI-DSS compliance, we must get an external Approved Scanning Vendor to scan our network from the outside to detect vulnerabilities. Essentially the vendor runs Nessus (or a similar tool) using a known PCI-DSS compliant configuration to provide independent verification of our network security. This must be done every quarter.

ASV scans are requested by raising an issue with the IBM team [here](https://github.ibm.com/CISO-PMO/Pentesting/issues/). Key points of contact are Justin Bauman and Neil Smith, who are in the #armada-asv-pentests private Slack channel.

The scans are slow to run: for IKS it can take 4-7 days. Findings must be triaged and either justified as a false positive (known as "disputing" the finding) or remediated and re-scanned. The whole process of achieving a clean scan can easily take 1 month in elapsed time, so don't leave it late to start! On successful completion, the offering will receive an "attestation of scan compliance" certificate, which must be filed in Box in the following locations ready for audit:
- Armada: https://ibm.ent.box.com/folder/72362249799
- Registry: https://ibm.ent.box.com/folder/77320423728

A reminder is generated quarterly reminding the team to schedule and perform the next ASV scan. Reminders are configured in https://github.ibm.com/alchemy-conductors/compliance-reminder-templates

#### PSIRT

We follow the IBM [PSIRT](https://w3-connections.ibm.com/communities/service/html/communityoverview?communityUuid=707492f9-bc2b-4556-b474-69c91e0b3db2) process to identify, assess and remediate technical security vulnerabilities using the [PSIRT intranet site](https://psirt.raleigh.ibm.com/). See [PSIRT process](psirt.html) for procedure.

#### Security Penetration Testing

Security Penetration testing in stage takes place regularly. In each 12-month period, at least one test must be carried out by an external company. Additional internal pen testing is carried out quarterly.

Penetration test reports will be retained for 2 years after the date of the report.

A reminder is generated quarterly reminding the team to schedule and perform the next penetration test. Reminders are configured in https://github.ibm.com/alchemy-conductors/compliance-reminder-templates

Reminders will be created as issues in the [Security repository](https://github.ibm.com/alchemy-conductors/security/issues/).

Note: The [WCP policy](https://pages.github.ibm.com/ibmcloud/Security/policy/Security-Assessment-and-Authorization.html) on pen testing specifies some requirements for pen testing and handling of the findings. That policy is in addition to what is documented here.

##### Pen Test Scope Sampling

Some of our production environments are too large to feasibly pen test all systems, so it is necessary to select subsets for testing using a sampling methodology. The IBM Compliance and Audit Readiness team has approved this approach, provided that the sampling methodology is documented and we have verified that the selected sample is representative of all critical elements of the environment.

The methodology for pen testing a single service whose total production environment exceeds 100 IP addresses will be as follows:

1. One production region will be selected at random from the list of regions where the service is deployed. This should be a different region from the previous pen test. Refer to the [pen test reminder issue history](https://github.ibm.com/alchemy-conductors/security/issues?utf8=%E2%9C%93&q=is%3Aissue+label%3AReminder+quarterly+penetration+test) for previous pen test details.

2. At least one API endpoint must be tested corresponding to the chosen production region.

3. A set of up to 100 production public IP addresses and another set of up to 100 production private IP addresses will be selected from the chosen region.

    - A limit smaller than 100 may be substituted if the pen tester needs a smaller number to work with, but the limit must be at least 30 and a pen tester capable of handling this scale must be used.

    - For Armada control plane, consider the machine types and IPs. For example, in an Armada Carrier some of the main machine types are master, worker, haproxy, Vyattas and there are also loadbalancer-vips so each IP sample set should include at least one of each of these.

    - For Armada clusters, the selection should include at least one ingress IP and at least one worker IP where possible. If there are any Vyattas in front of the cluster then their IPs should be included, although use of Vyattas with Armada clusters is rare. In some cases a cluster might have no ingress IP or only private IPs which are unreachable by an external pen tester; how to satisfy this requirement depends upon the cluster and the type of pen test.

    - For Registry Classic, machine types include registry-docker, registry-endpoint and the Vyatta firewalls that front them so each IP sample set should include at least one of each.

    - The reasoning for all sample choices must be explained. Wherever possible, automated random sampling should be used. For example, a tool like `shuf` can be used with `head` to shuffle the lines in a file and select the first N lines to ensure a random selection, e.g. `cat example | shuf | head -100` selects 100 lines at random from the file named `example`.

The sampling methodology must be documented in the pen test reminder GitHub issue as follows, filling in the sections in `{BRACES}`:

```
## {SERVICE NAME} sample methodology

The following samples were selected according to the sampling methodology in the Vulerability Management process:

- Randomly chosen region: {REGION}

- API endpoint to be tested from the chosen region: {REGION_URL},

- List of public IP addresses chosen from the region: {IP LIST GOES HERE}

- List of private IP addresses chosen from the region (if applicable): {IP LIST GOES HERE}
    - For some pen tests such as external pen tests, this might not be possible and may be marked N/A.

- Explanation of why this is a representative sample covering all critical functions in the region: {EXPLANATION}
```

##### Pen Test Findings

Security vulnerabilities that are found through penetration testing will be raised as issues in the following repositories:

- Armada: https://github.ibm.com/alchemy-containers/armada/issues
- Registry: https://github.ibm.com/alchemy-registry/va-registry-product/issues

Each pen test issue must have:

- The quarter and year when the test was conducted in its title (e.g. 3Q2018)
- The label `Pen-Test-Finding` attached

The person assigned to each issue should review the vulnerability findings to assess the impact:

- If the issue is a false positive (meaning the finding is erroneous), the issue must be labeled with `False-Positive` with an explanation. The Security Focal will review the explanation and will decide if the issue can be closed.

- If the issue is genuine but the development team has decided not to fix it for some reason then the Security Focal will review. If the Security Focal concurs, a manager from the organization must comment on the issue to approve that the issue will not be fixed and a PCE exception is required.
 
- Otherwise, ensure remediation of the vulnerability. A [PSIRT](./psirt.html) record may be required depending on WCP policy requirements. If the issue cannot be remediated within policy timelines, the PSIRT deferral process should be used to defer the fix. If the vulnerability is not tracked by the PSIRT process a PCE exception may be required.

The issue must not be closed until all of the following criteria are satisfied:

- All triage and analysis of the issue is complete.

- The Security Focal has determined whether a PSIRT record is required and, if so, the PSIRT record has been created. If a PSIRT advisory is required, its number must be included in the issue.

- The Security Focal has determined whether a PCE exception is required and, if so, the PCE exception has been drafted and submitted. If a PCE exception is required, its number must be included in the issue.

- If the issue is to be fixed, the code fix has been:
  - completed
  - tested for regressions and
  - deployed to production

- If the issue is not to be fixed, an explanation must be provided in the issue. Also, if the issue is genuine then the Security Focal must comment on the issue to document agreement to close and a manager from the organization must approve the closure by commenting on the issue.

#### CISO architecture reviews

CISO architecture reviews are conducted according to the [CISO security review policy](https://pages.github.ibm.com/ibmcloud/Security/architectural_review/detail.html).
Security vulnerabilities that are found through the review process will be recorded as GHE issues with the label `CISO-Review-Finding` [(GHE query)](https://github.ibm.com/issues?utf8=%E2%9C%93&q=is%3Aissue%20label%3ACISO-Review-Finding%20).

The findings should be resolved within the timeframe recommended by the review. In the absence of a recommended resolution timeline, the responder or assignee should review the findings for impact assessment and generate a plan showing how and when to remediate the findings.

Remediation timelines will be dictacted by the strictest set of requirements. At a minimum by IBM internal ITSS requirements, as well as any other compliance guidelines that apply to this service. Exceptions may be sought if additional time is needed or if an issue cannot be resolved.

#### Static Code Analysis

Static code analysis (e.g. go vet, go lint) is performed at least every six months or after major architectural changes on base images and code for IBM services and applications running on the Armada control plane. For most squads this is integrated with the build infrastructure so it occurs for every build. Squad members must review and triage issues raised by static analysis and remediate them appropriately according to the timelines laid out in [Remediation of vulnerabilities](#remediation-of-vulnerabilities). A [PSIRT](./psirt.html) record may be required depending on WCP policy requirements. If an issue cannot be remediated within policy timelines, a PCE exception will be required.

Additionally, regular [ASoC](https://appscan.ibmcloud.com/AsoCUI/serviceui/home) static code scans are run for the Armada UI to mitigate the risk of OWASP Top 10 (and similar) web application attacks; this is a requirement for PCI DSS control 6.6. Prior to 2019-03-31 scans were run weekly by the Security Compliance squad, results were stored [here](https://github.ibm.com/alchemy-conductors/compliance-appscan-results) and findings were raised [here](https://github.ibm.com/alchemy-containers/armada-ui/issues?utf8=%E2%9C%93&q=is%3Aissue+is%3Aopen+ASoc+scan+findings). Since 2019-03-31 static scans have been running automtically through the Console pipeline.  

#### Dynamic web scans

Regular [ASoC](https://appscan.ibmcloud.com/AsoCUI/serviceui/home) dynamic web scans are run for the Armada UI.  Dynamic scans are run automatically through the console pipeline.  

### Remediation of vulnerabilities

Vulnerabilities must be remediated within the timelines dictated below. The timelines are designed to adhere to [ITSS section 6.7.3](https://pages.github.ibm.com/it-standards/main/2015/01/24/itss.html#673-remediation-and-patching).

The timelines below are counted from when the given tool discovers that a security vulnerability applies to the scanned asset.

In the case that a vendor patch is not available for a known vulnerability, mitigating preventive controls must be applied until a patch becomes available or an exception must be sought.

In the event of a CIO Override Vulnerability Advisory, time limits within that advisory will supersede the timelines in this standard. Days are calendar days, and include holidays and weekends.

According to [ITSS section 6.7.3](https://pages.github.ibm.com/it-standards/main/2015/01/24/itss.html#673-remediation-and-patching), “Business Areas may use the [Security Severity Assessment Rating method](https://w3-connections.ibm.com/wikis/home?lang=en-us#!/wiki/W768539b1163e_4326_8520_26b7a81ab48a/page/Security%20Severity%20Assessment%20Rating) to determine how their specific environment affects the severity rating of vulnerabilities.” This assessment takes into account whether a vulnerability's ease of exploitation affects the severity rating.

The severity ratings assessed by tools and third parties shall be taken as correct unless overridden by the Security Focal for a documented reason. Any such overrides must be documented in a GHE issue and an exception must be raised.

##### Timeline for remediating vulnerabilities

Refer to the [WCP Policy](https://pages.github.ibm.com/ibmcloud/Security/policy/Risk-Assessment-Policy.html#vulnerability-management).


##### Timeline for remediating CIS healthcheck benchmark deviations

As per [WCP Policy](https://pages.github.ibm.com/ibmcloud/Security/policy/Configuration-Management-Policy.html#configuration-settings), healthcheck evaluations/reviews are performed on a quarterly basis.  Any deviations found during the evaluation without associated risks must be remediated within 60 days of the evaluation/review date.

Details of Health check evaluations and deviations can be found in the [Security repository](https://github.ibm.com/alchemy-conductors/security/issues) 

### Rebuilding assets

It is recommended that container images are regularly rebuilt and containers redeployed from the rebuilt image to ensure that no container is running an image older than 7 days. This is to ensure that every running container has the current security vulnerability fixes within the ITSS high severity time limit. This is particularly recommended where a container has substantial portions of an operating system or large amounts of third party code inside.

Containers built "from scratch" contain much less code and are at lower risk from vulnerabilities due to having a smaller attack surface, although squads should still consider how best to keep these container images current. Where applicable (e.g. where VA doesn't support the base OS of the image), the Security Compliance Squad must add PSIRT registrations for all of the major components inside the container.

This section will be kept up-to-date as new guidance is issued.

## Exceptions

All exceptions must be reviewed by the Security Compliance Squad and management.

Exceptions must be raised as a GHE item in [Security repository](https://github.ibm.com/alchemy-conductors/security/issues/new?assignees=&labels=Compliance%2C+Risk+Request%2C+wwbcit&template=exception-risk-request.md&title=), and a PCE risk evluation is used for the formal exception.

## Reviews

Last review: 2023-06-14 Last reviewer: Hannah Devlin Next review due by: 2024-06-14
